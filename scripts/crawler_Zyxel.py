import requests
import re
from utils import cache_url
import multiprocessing as mp

def retrieve_one(model):
    response = requests.get(f'https://www.zyxel.com/global/en/support/download?model={model}')
    download_urls = set(re.findall(f'https://.*?{model}.*?\.zip', response.text))
    for download_url in download_urls:
        cache_url(download_url, 'Zyxel')
        print(download_url)
        return

if __name__ == '__main__':
    pool = mp.Pool(processes=mp.cpu_count())
    tasks = list()
    models = {'USG20W-VPN', 'NBG6615', 'NSW200-28P', 'NR5101', 'NSG50', 'ATP800', 'NWA1123-ACv2', 'NWA5301-NJ', 'GS1900-8', 'NWA5121-NI', 'WRE6605', 'USG20-VPN', 'WAC5302D-Sv2', 'NXC5500', 'WAC6503D-S', 'LTE4506-M606', 'USG FLEX 50', 'DAC10G-1M', 'XGS2210-28', 'ANT1106', 'SFP-SX-E', 'GS1100-24', 'VPN2S', 'Vantage CNM 2.3', 'LIC-HSM', 'USG60W', 'EMG6726-B10A', 'SFP-BX1310-E', 'GS1900-16', 'USG FLEX 100', 'ZyAIR EXT-118', 'NBG6604', 'Multy Plus (WSQ60)', 'Accessory', 'NWA210AX', 'NXC2500', 'GS2220-28HP', 'XGS4600-32', 'LTE3202-M437', 'Omni 56K COM Plus', 'ZyAIR EXT-106', 'LTE7480-M804', 'Armor G5 (NBG7815)', 'LTE3301-M209', 'GS1920-8HPv2', 'SFP-LHX1310-40-D', 'XGS-4526', 'GS1350-12HP', 'WAC500H', 'GS1900-10HP', 'ES-2108PWR', 'VMG3625-T50B', 'GS1920-48HPv2', 'GS2220-10', 'ZyAIR EXT-300', 'XGS1930-28', 'USG210', 'LIC-NPRO', 'ANT107', 'GS2220-50HP', 'LIC-CNP', 'GS1005HP', 'VPN50', 'NWD6605', 'NR7101', 'XGS1930-52', 'GS1920-48v2', 'WAC5302D-S', 'ZyAIR EXT-105', 'ES-108A v3', 'LTE3316-M604', 'ZyWALL 1100', 'ZYWALL USG 200', 'MG-108', 'GS1920-24HPv2', 'ZAC', 'GS1915-24EP', 'ZoneDAS One', 'WAC6552D-S', 'GS1915-8EP', 'XGS1930-28HP', 'GS1300-18HP', 'USG2200', 'Nebula LTE3301-PLUS', 'LIC-CES', 'LIC-NMSP', 'Multy U (WSR30)', 'ANT3108', 'VMG4005-B50A', 'ZYWALL USG 100', 'XMG3927-B50A', 'USG FLEX 500', 'ANT1313', 'SFP10G-SR-E', 'WAP6804', 'NWD6602', 'SecuExtender VPN Client', 'SFP10G-LR', 'NWA1302-AC', 'ZyWALL 310', 'GS1350-6HP', 'XGS1010-12', 'VPN1000', 'LIC-CCF', 'LIC-Deployer', 'GS1300-26HP', 'NWA1123-AC PRO', 'WAC6553D-E', 'NWD7605', 'GS1350-26HP', 'GS1915-24E', 'ZyAIR EXT-108', 'ZyWALL USG 20', 'WAC500', 'CNC', 'XS1930-12HP', 'GS1200-5HP v2', 'LTE7240-M403', 'XS3800-28', 'LIC-APM', 'ATP100', 'Multy M1 (WSM20)', 'ANT2105', 'NBG6515', 'GS2220-10HP', 'SFP-BX1310-10-D', 'WAX640S-6E', 'WAX650S', 'WRE2206', 'LIC-SECRP', 'NAP203', 'USG FLEX 200', 'GS1900-24EP', 'LIC-CAS', 'GS1100-10HP', 'SFP-LX-10-D', 'GS1915-8', 'XGS3700-24HP', 'XGS3700-48HP', 'XGS3700-24', 'VRPT', 'USG110', 'GS1900-24', 'MagicOffice Repeater', 'USG2200-VPN', 'SFP-100LX-20', 'ZyWALL USG 50', 'LIC-NPLUS', 'ZyWALL OTPv2', 'PLA5456', 'MG-105', 'VMG8825-T50K', 'PoE12-HP', 'NWA1123-AC HD', 'LTE7461-M602', 'PLA6456', 'ATP200', 'NBG-418N v2', 'USG1900', 'WAX610D', 'PLA6457', 'WX3100-T0', 'ZyAIR EXT-109', 'ANT1315', 'XGN100F', 'ES-2024A', 'EX3301-T0', 'GS2220-50', 'GS1200-5', 'LIC-Astra', 'WAP3205 v3', 'NSG300', 'GS1200-8', 'SFP-100FX-2', 'Armor G1 (NBG6818)', 'USG40W', 'MC1000-SFP-FP', 'USG60', 'SFP-LX-10-E', 'GS1900-48HPv2', 'NWA5160N', 'Multy Mini(WSQ20)', 'LTE7490-M904', 'ATP500', 'ZyWALL USG 300', 'SFP-BX1550-E', 'SFP-100TX', 'ATP100W', 'ANT2206', 'USG FLEX 700', 'ATP700', 'USG310', 'ES1100-24', 'WAC6103D-I', 'ZyWALL USG 2000', 'NWA50AX', 'VSG-1200 V2', 'ZyWALL USG 1000', 'LTE5366-M608', 'WAC6303D-S', 'WAC6502D-S', 'ZyAIR EXT-114', 'USG40', 'Nebula NR5101', 'ANT3320', 'PLX111', 'SecuReporter', 'XGS2210-52', 'ZYWALL USG 20W', 'NWA110AX', 'GS-105B v3', 'RGS200-12P', 'ES1100-24E', 'SFP10G-LR-E', 'ANT3218', 'LTE5388-M804', 'DAC10G-3M', 'LTE3302-M432', 'GS-108S v2', 'NWA55AXE', 'GS1900-8HP', 'ANT3316', 'GS1900-24HPv2', 'SSO Agent', 'GS1200-8HP v2', 'NAS326', 'LIC-GEO', 'HLA4205', 'GS-105S v2', 'GS1100-16', 'LTE3301-PLUS', 'XGS4600-52F', 'ZON Utility', 'SymmRepeater', 'ES-2024PWR', 'SFP10G-SR', 'VMG1312-T20B', 'Vantage Report 2.3', 'Nebula CC', 'USG FLEX 100W', 'XGS1250-12', 'LMR 400-N', 'GS1100-24E', 'NR2101', 'WAX510D', 'NWA220AX-6E', 'XGS2210-28HP', 'XGS1930-52HP', 'VMG3312-T20A', 'NWA90AX', 'NBG7510', 'XS1930-10', 'GS2220-28', 'ANT3315', 'NXC5200', 'RGS100-5P', 'LIC-CPS', 'WAH7601', 'ES1100-16', 'WRE6505 v2', 'SFP-BX1490-10-D', 'NWA5123-AC HD', 'NAP303', 'Nebula LTE7461-M602', 'ES-2108-G', 'ANT1310', 'NWA1100-NH', 'XGS1210-12', 'LIC-HA-Pro', 'NAP353', 'PoE12-30W', 'SFP-ZX-80-D', 'WAX630S', 'ES-105E v2', 'GS-108B v3', 'ES-2108', 'LTE7460-M608', 'ES1100-8P', 'GS1900-48', 'VPN100', 'GS1350-18HP', 'XGS4600-32F', 'VPN300', 'LIC-SAPC', 'PoE12-60W', 'NAP102', 'GS1008HP', 'DX3301-T0', 'LTE2566-M634', 'NSG200', 'ES-108S', 'SFP-SX-D', 'LIC-IDP', 'NWD2205', 'SFP-1000T', 'NAS540', 'WAX620D-6E', 'GS1300-10HP', 'NSG100', 'NWA5123-AC', 'LMR 200-N', 'XS1930-12F', 'GS1920-24v2', 'iCard', 'LIC-BAV', 'NWA1123ACv3', 'WAH7706', 'ZyWALL 110', 'XGS2210-52HP', 'USG1100', 'Nebula NR7101', 'ES-108E v2', 'PLA5405 v2', 'Vantage Report 3.0', 'ZWO', 'GS1900-24E', 'Multy X (WSQ50)', 'XGN100C', 'ANT1314', 'ES-105A v3', 'XGS3700-48'}
    for model in models:
        task = pool.apply_async(func=retrieve_one, args=(model,))
        tasks.append(task)
    pool.close()
    pool.join()
    for task in tasks:
        task.wait()
    print('Done!')