from utils import *
import multiprocessing as mp

def retrieve_one(url):
    html = get_html(url)
    for label in html.find_all('a', href=lambda href : href is not None and href.startswith('https://static.tp-link.com/upload/firmware/')):
        download_url = label['href']
        print(download_url)
        cache_url(download_url, 'TP-Link')
        return

if __name__ == '__main__':
    pool = mp.Pool(processes=mp.cpu_count())
    tasks = list()
    models = {'TL-WDR4900', 'TL-SG108S', 'TL-WPA4530 KIT', 'TL-SF1048', 'Archer T4E', 'Archer C20', 'Archer AX20', 'TL-SG5428', 'TL-WN823N', 'TL-SG2224WEB', 'Deco M4', 'TL-SG1008MP', 'Tapo C210', 'TL-SG1008PE', 'Archer AX72', 'UH720', 'CPE220', 'TL-SG2424P', 'TL-R470T+', 'TL-SF1005D', 'TL-SG116', 'Archer T5E', 'TL-WPA7517 KIT', 'RE650', 'Archer T2U Nano', 'TL-SG1218MP', 'RE365', 'TL-ANT2424B', 'TL-SF1005P', 'MC110CS', 'CPE610', 'TL-PA4030KIT', 'TL-WR940N', 'TL-SF1006P', 'TL-SF1008D', 'Tapo P100', 'TL-WN751N', 'RE605X', 'TL-R402M', 'TL-SG3428', 'TL-WPA8631P KIT', 'TL-PA7010P KIT', 'TL-WN721NC', 'TL-SG2210MP', 'TL-SG3424P', 'MC210CS', 'UC430', 'Archer MR200', 'TG-3269', 'TL-POE10R', 'Archer C1200', 'TL-SL1218MP', 'Tapo C310', 'TC-7610', 'UH700', 'Archer VR2800v', 'TD-W8151N', 'TL-POE4824G', 'Deco P9', 'TL-ER7206', 'TL-SF1005LP', 'TL-SL1226', 'Deco XE75 Pro', 'RE205', 'TL-SM321B', 'Archer TX3000E', 'TL-SG1016DE', 'TL-MR100', 'Archer VR900', 'Archer AX50', 'TL-WN821N', 'Tapo L900-5', 'Deco XE75', 'Archer AXE75', 'TL-SF1024', 'Touch P5', 'TL-SG1008', 'TL-WDN4800', 'TL-ANT24SP', 'Tapo L510E', 'TL-SM321A-2', 'VIGI C300HP', 'TX432', 'TL-SM311LM', 'TL-SL1117', 'TL-SG1008P', 'EAP265 HD', 'Archer TX20U Plus', 'RE315', 'VIGI C340', 'Archer VR2800', 'TL-POE2412G', 'UE300', 'TL-SF1008P', 'TL-SF1016D', 'M7000', 'Archer C60', 'TL-WN723N', 'Archer AX55', 'ER605', 'TL-PA4030', 'Archer GX90', 'tpNMS', 'Archer T4U Plus', 'UB4A', 'TL-MC1400', 'TL-ANT2408CL', 'TL-ANT2414A', 'TL-ANT2412D', 'TL-WDN3800', 'UE300C', 'LS1005', 'TL-SC3430N', 'TL-SG116E', 'Deco X60', 'TL-WR741ND', 'Tapo C320WS', 'TL-WN721N', 'TL-POE200', 'Archer T2U', 'UB400', 'TL-SG1016', 'Archer C64', 'LS1008G', 'TL-PA6030KIT', 'TL-ANT2409CL', 'TG-3468', 'EAP225-Wall', 'TL-SF1016DS', 'VIGI C400HP', 'RE580D', 'TL-SG1218MPE', 'UB500', 'Deco E4', 'Pharos Control', 'TL-ANT24EC12N', 'MC112CS', 'Archer AX73', 'EAP660 HD', 'TL-WN881ND', 'TL-SG108-M2', 'Tapo C100', 'TL-SG105-M2', 'TL-SG3428XMP', 'TL-SG1005LP', 'TL-SG1024D', 'TL-WPA4220', 'TL-SF1016', 'Archer VR1600v', 'Archer T9UH', 'TL-PA8010P KIT', 'TL-WPA8631P', 'CPE710', 'TL-SG1024DE', 'TD-W8980B', 'TL-WN722NC', 'TL-SG105S', 'RE505X', 'Deco X20', 'RE215', 'LS1008', 'TL-ANT24EC6N', 'Archer C80', 'MC111CS', 'TL-SG2008', 'NC260', 'Deco X20-4G', 'TL-WPA4220 TKIT', 'TL-SX1008', 'OC300', 'Archer AX10', 'TC70', 'TL-ANT24PT', 'VIGI C400P', 'TL-WPA4220 KIT', 'TL-FC1420', 'Archer TX50E', 'TL-PA4020 KIT', 'TL-SM221A', 'TL-SG105E', 'Archer C50', 'TL-SL3428', 'TL-WN751ND', 'Deco X90', 'TL-WN725N', 'TL-ANT2414B', 'TL-SG1016PE', 'TL-PA4010 KIT', 'EAP235-Wall', 'M7200', 'Archer VR2100', 'TL-SG108E', 'EAP115-Wall', 'VIGI NVR1008H', 'RPS150', 'TL-SF1009P', 'TL-FC111B-20', 'TL-PA6010KIT', 'CR1900', 'TL-FC311A-20', 'TL-SM321A', 'M7450', 'RPS2', 'TL-SL1226P', 'TL-SG105', 'TD-VG3511', 'TL-WA860RE', 'TL-SG1210MP', 'TL-SG1048', 'TL-SG5412F', 'TL-ANT5819MS', 'TL-SG2424', 'MA180', 'CP230', 'MA260', 'TD-8840', 'TL-ANT2409A', 'TL-PA9020P KIT', 'TXC432-CU3M', 'Archer T2U Plus', 'Archer T3U Plus', 'Deco M5', 'TL-SM5220-1M', 'CPE210', 'Archer VR600v', 'TL-SG5426', 'TL-POE150S', 'Archer MR600', 'TL-SG2428P', 'TL-MR6400', 'UC400', 'CAP1750', 'TL-ANT5830MD', 'TL-ANT24EC5S', 'Archer C6', 'TD-W8980', 'TL-WN781ND', 'TL-PA7017 KIT', 'LS1005G', 'TF-3239DL', 'TL-SG2210P', 'TL-SG3452P', 'UH400', 'Deco X68', 'TL-FC311B-20', 'TL-SM311LS', 'CP250', 'TL-SG3452', 'M7650', 'RE450', 'M5350', 'TL-PA6010', 'VIGI C300P', 'TL-SM5110-SR', 'EAP225', 'TL-ANT24EC3S', 'VIGI NVR1008', 'Archer AX75', 'TL-WR720N', 'TL-PA7017P KIT', 'TL-SG3210XHP-M2', 'EAP610', 'VIGI Security Manager', 'TL-SM321B-2', 'TL-SG3424', 'TL-FC111PB-20', 'TXM431-LR', 'TL-SG3216', 'TL-SM5220-3M', 'TL-WR740N', 'RE200', 'Archer TXE75E', 'TL-PA4030T KIT', 'KP105', 'EAP245', 'TL-WPA7617 KIT', 'TL-SF1024D', 'TL-R460', 'Archer T3U', 'Archer AX90', 'HA100', 'Archer VR900v', 'MC220L', 'TL-SG3428X', 'P1200-08', 'AC50', 'TL-SG108PE', 'VIGI NVR1016H', 'TL-WA730RE', 'TL-WA855RE', 'MC200CM', 'TL-FC111A-20', 'RE500X', 'TL-SG3210', 'TL-WR802N', 'TL-ANT5830B', 'Archer AX23', 'TL-ANT2409B', 'UE330', 'TL-WR840N', 'BS1001', 'TX401', 'Tapo L530E', 'Tapo C110', 'Deco X80-5G', 'TL-SG1008D', 'TL-SL2428P', 'RE550', 'TL-ANT24PT3', 'Archer T4U', 'TL-SL5428E', 'TL-SG1005P', 'TL-SG2008P', 'LS108G', 'TD-8840T', 'TL-SL1311MP', 'TL-SG1428PE', 'TXC432-CU1M', 'TL-SG1016D', 'TL-ANT2415D', 'UE200', 'Archer MR400', 'LS105G', 'TL-SG2218', 'Archer T6E', 'TL-SG3428MP', 'VIGI C440', 'EAP620 HD', 'TL-WA890EA', 'TC60', 'RE305', 'TL-SL1351', 'TL-SC3430', 'TL-SM221B', 'EAP330', 'EAP115', 'TL-WA701ND', 'TXM431-SR', 'KP303', 'Deco X50', 'TL-SX105', 'EAP110', 'TL-SG105PE', 'Deco X75', 'TL-POE160S', 'MC100CM', 'TL-SG1024', 'TL-SM5110-LR', 'TL-WR902AC', 'TL-ER604W', 'TL-WA1201', 'RE590T', 'Archer T2E', 'TL-SG1005D', 'M7350', 'Archer AX6000', 'CPE510', 'Archer AX11000', 'OC200', 'AC500', 'Omada Software Controller', 'TL-MCRP100', 'Tapo P110', 'Tapo C200', 'TL-WR820N', 'EAP225-Outdoor', 'TD-W8101G', 'TL-SL1218P', 'Tapo L920-5', 'Archer VR600', 'TL-SF1008LP', 'TL-SG1210P', 'TF-3239D', 'VIGI C440-W', 'VIGI C340-W', 'PSM150-AC', 'TL-SC4171G', 'TL-RP108GE', 'Deco M9 Plus', 'TL-WR841N', 'Archer C5 V4', 'TL-PA4020P', 'TL-WA850RE', 'TL-SG108', 'TD-W150KIT', 'TL-SF1024M', 'T3700G-52TQ'}
    for model in models:
        url = f'https://www.tp-link.com/hk/support/download/{model}'
        task = pool.apply_async(func=retrieve_one, args=(url,))
        tasks.append(task)
    pool.close()
    pool.join()
    for task in tasks:
        task.wait()
    print('Done!')